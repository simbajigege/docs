"use strict";(self.webpackChunkdyte_docs=self.webpackChunkdyte_docs||[]).push([[12254,89873],{12254:(e,t,a)=>{a.r(t),a.d(t,{dyte_participants_audio:()=>c});var i=a(72944),s=a(64383),r=a(41960),d=a(74157),n=a(17073),o=a(94370);class l{constructor(e){this.meeting=e,this.audio=document.createElement("audio"),this.audio.autoplay=!0,this.audioStream=new MediaStream,this.audio.srcObject=this.audioStream,this.audioTracks=[]}addTrack(e,t){this.audioTracks.some((t=>t.id===e))||(this.audioTracks.push({id:e,track:t}),this.audioStream.addTrack(t),this.play())}removeTrack(e){const t=this.audioTracks.find((t=>t.id===e));null!=t&&(this.audioStream.removeTrack(t.track),this.audioTracks=this.audioTracks.filter((t=>t.id!==e)))}async play(){var e;this.audio.srcObject=this.audioStream,await(null===(e=this.audio.play())||void 0===e?void 0:e.catch((e=>{"NotAllowedError"===e.name?null!=this._onError&&this._onError():"AbortError"!==e.name&&r.l.error("[dyte-audio] play() error\n",e)})))}async setDevice(e){var t,a,i;(0,s.d)(this.meeting)||await(null===(i=null===(a=(t=this.audio).setSinkId)||void 0===a?void 0:a.call(t,e))||void 0===i?void 0:i.catch((e=>{r.l.error("[dyte-audio] setSinkId() error\n",e)})))}onError(e){this._onError=e}}const c=class{constructor(e){(0,i.r)(this,e),this.dialogClose=(0,i.c)(this,"dialogClose",7),this.onDyteDialogClose=()=>{this.showPlayDialog=!1,this.dialogClose.emit()},this.meeting=void 0,this.iconPack=n.d,this.t=(0,d.u)(),this.showPlayDialog=!1}componentDidLoad(){this.meetingChanged(this.meeting)}disconnectedCallback(){var e;null!=this.meeting&&(this.audioUpdateListener&&this.meeting.participants.joined.removeListener("audioUpdate",this.audioUpdateListener),this.screenShareUpdateListener&&this.meeting.participants.joined.removeListener("screenShareUpdate",this.screenShareUpdateListener),this.participantLeftListener&&this.meeting.participants.joined.removeListener("participantLeft",this.participantLeftListener),this.deviceUpdateListener&&this.meeting.self.removeListener("deviceUpdate",this.deviceUpdateListener),this.stageStatusUpdateListener&&(null===(e=this.meeting.stage)||void 0===e||e.removeListener("stageStatusUpdate",this.stageStatusUpdateListener)))}async setupAudio(){this.audio=new l(this.meeting);const e=this.meeting.self.getCurrentDevices();null!=e.speaker&&await this.audio.setDevice(e.speaker.deviceId)}async handleAutoPlayError(){this.audio||await this.setupAudio(),this.audio.onError((()=>{this.showPlayDialog=!0})),this.audio.play()}async handleEvents(e){this.audioUpdateListener=({id:e,audioEnabled:t,audioTrack:a})=>{const i=`audio-${e}`;t&&null!=a?this.audio.addTrack(i,a):this.audio.removeTrack(i)};const t=e.participants.joined.toArray();for(const a of t)this.audioUpdateListener(a);this.participantLeftListener=({id:e})=>{this.audio.removeTrack(`audio-${e}`),this.audio.removeTrack(`screenshare-${e}`)},this.screenShareUpdateListener=({id:e,screenShareEnabled:t,screenShareTracks:a})=>{const i=`screenshare-${e}`;t&&null!=a.audio?this.audio.addTrack(i,a.audio):this.audio.removeTrack(i)},this.deviceUpdateListener=({device:e,preview:t})=>{t||"audiooutput"===e.kind&&this.audio.setDevice(e.deviceId)},e.participants.joined.addListener("audioUpdate",this.audioUpdateListener),e.participants.joined.addListener("screenShareUpdate",this.screenShareUpdateListener),e.participants.joined.addListener("participantLeft",this.participantLeftListener),e.self.addListener("deviceUpdate",this.deviceUpdateListener)}async meetingChanged(e){var t;null!=e&&(this.setupAudio(),(0,o.a)(e)?(this.stageStatusUpdateListener=async e=>{"ON_STAGE"===e&&await this.handleAutoPlayError()},null===(t=e.stage)||void 0===t||t.on("stageStatusUpdate",this.stageStatusUpdateListener)):await this.handleAutoPlayError(),await this.handleEvents(e))}render(){return(0,i.h)(i.H,null,this.showPlayDialog&&(0,i.h)("dyte-dialog",{open:!0,onDyteDialogClose:this.onDyteDialogClose,hideCloseButton:!0,disableEscapeKey:!0,iconPack:this.iconPack,t:this.t},(0,i.h)("div",{class:"modal"},(0,i.h)("h3",null,this.t("audio_playback.title")),(0,i.h)("p",null,this.t("audio_playback.description")),(0,i.h)("dyte-button",{kind:"wide",onClick:()=>{this.audio.play(),this.onDyteDialogClose()},title:this.t("audio_playback"),iconPack:this.iconPack,t:this.t},this.t("audio_playback")))))}static get watchers(){return{meeting:["meetingChanged"]}}};c.style=":host{line-height:initial;font-family:var(--dyte-font-family, sans-serif);font-feature-settings:normal;font-variation-settings:normal}p{margin:var(--dyte-space-0, 0px);padding:var(--dyte-space-0, 0px)}:host{display:block;color:rgb(var(--dyte-colors-text-1000, 255 255 255))}.modal{box-sizing:border-box;width:100%;max-width:var(--dyte-space-96, 384px);padding:var(--dyte-space-4, 16px);border-radius:var(--dyte-border-radius-md, 8px);--tw-bg-opacity:1;background-color:rgba(var(--dyte-colors-background-1000, 8 8 8) / var(--tw-bg-opacity))}.modal h3{margin:var(--dyte-space-0, 0px);padding:var(--dyte-space-0, 0px);font-size:24px;font-weight:500}.modal p{margin-top:var(--dyte-space-4, 16px);margin-bottom:var(--dyte-space-6, 24px)}.modal dyte-button{width:100%}"},64383:(e,t,a)=>{a.d(t,{F:()=>s,d:()=>n,i:()=>r,u:()=>d});var i=a(94370);const s={PLAY_PARTICIPANT_TILE_VIDEO_ON_PAUSE:"play_participant_tile_video_on_pause",DISABLE_EMOJI_PICKER:"disable_emoji_picker",FEAT_PAGINATED_CHAT:"feat_paginated_chat",LOG_PLAYING_FAILURES:"log_playing_failures",FEAT_CHANNEL_CHAT:"feat_channel_chat",FEAT_PARTICIPANT_LIST:"feat_participant_list",DISABLE_KICKING:"disable_kicking",ADMIN_CANTREMOVE_ADMIN:"admin_cantremove_admin",CANTINVITE_VIEWER:"cantinvite_viewer",PINNED_MESSAGES:"pinned_msgs"},r=e=>e.connectedMeetings.supportsConnectedMeetings,d=e=>{var t;return"CHAT"===(null==e?void 0:e.meta.viewType)||(0,i.s)(e)||(null===(t=null==e?void 0:e.__internals__)||void 0===t?void 0:t.features.hasFeature("feat_paginated_chat"))},n=e=>{var t,a;return(null===(t=null==e?void 0:e.__internals__)||void 0===t?void 0:t.browserSpecs.isFirefox())&&(null===(a=null==e?void 0:e.__internals__)||void 0===a?void 0:a.features.hasFeature("disable_firefox_setting_sink_id"))}},94370:(e,t,a)=>{a.d(t,{P:()=>d,a:()=>i,b:()=>n,c:()=>o,d:()=>l,i:()=>s,s:()=>r});const i=e=>!!r(e)&&("LIVESTREAM"===e.meta.viewType&&"ON_STAGE"!==e.stage.status),s=e=>{var t;return!!r(e)&&("LIVESTREAM"===e.meta.viewType&&(null===(t=null==e?void 0:e.self)||void 0===t?void 0:t.permissions.canLivestream))},r=e=>{var t;return(null===(t=null==e?void 0:e.self)||void 0===t?void 0:t.permissions.isV2)&&(null==e?void 0:e.livestream)};var d,n;!function(e){e.BUFFERING="Buffering",e.ENDED="Ended",e.IDLE="Idle",e.PLAYING="Playing",e.READY="Ready"}(d||(d={})),function(e){e.INITIALIZED="PlayerInitialized",e.QUALITY_CHANGED="PlayerQualityChanged",e.DURATION_CHANGED="PlayerDurationChanged",e.VOLUME_CHANGED="PlayerVolumeChanged",e.MUTED_CHANGED="PlayerMutedChanged",e.PLAYBACK_RATE_CHANGED="PlayerPlaybackRateChanged",e.REBUFFERING="PlayerRebuffering",e.AUDIO_BLOCKED="PlayerAudioBlocked",e.PLAYBACK_BLOCKED="PlayerPlaybackBlocked",e.ERROR="PlayerError",e.RECOVERABLE_ERROR="PlayerRecoverableError",e.ANALYTICS_EVENT="PlayerAnalyticsEvent",e.TIME_UPDATE="PlayerTimeUpdate",e.BUFFER_UPDATE="PlayerBufferUpdate",e.SEEK_COMPLETED="PlayerSeekCompleted",e.SESSION_DATA="PlayerSessionData",e.STATE_CHANGED="PlayerStateChanged",e.WORKER_ERROR="PlayerWorkerError",e.METADATA="PlayerMetadata",e.TEXT_CUE="PlayerTextCue",e.TEXT_METADATA_CUE="PlayerTextMetadataCue",e.AD_CUE="PlayerAdCue",e.STREAM_SOURCE_CUE="PlayerStreamSourceCue",e.NETWORK_UNAVAILABLE="PlayerNetworkUnavailable",e.SEGMENT_DISCONTINUITY="PlayerSegmentDiscontinuity",e.SEGMENT_METADATA="PlayerSegmentMetadata",e.PLAYER_METADATA="PlayerMetadata"}(n||(n={}));const o=[n.TIME_UPDATE,n.BUFFER_UPDATE,n.TEXT_METADATA_CUE,n.PLAYER_METADATA],l=[n.REBUFFERING,n.AUDIO_BLOCKED,n.PLAYBACK_BLOCKED,n.ERROR,n.RECOVERABLE_ERROR,n.WORKER_ERROR,n.NETWORK_UNAVAILABLE,n.ANALYTICS_EVENT,n.PLAYBACK_RATE_CHANGED,n.QUALITY_CHANGED,n.INITIALIZED]},41960:(e,t,a)=>{a.d(t,{l:()=>i});const i=console}}]);