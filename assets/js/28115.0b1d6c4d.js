"use strict";(self.webpackChunkdyte_docs=self.webpackChunkdyte_docs||[]).push([[28115],{91364:(t,e,s)=>{s.d(e,{d:()=>p});var i=s(49583),r="[object Symbol]";var n=/\s/;var o=/^\s+/;function a(t){return t?t.slice(0,function(t){for(var e=t.length;e--&&n.test(t.charAt(e)););return e}(t)+1).replace(o,""):t}var l=NaN,h=/^[-+]0x[0-9a-f]+$/i,c=/^0b[01]+$/i,d=/^0o[0-7]+$/i,g=parseInt;function u(t){if("number"==typeof t)return t;if(function(t){return"symbol"==typeof t||(0,i.i)(t)&&(0,i.b)(t)==r}(t))return l;if((0,i.a)(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=(0,i.a)(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=a(t);var s=c.test(t);return s||d.test(t)?g(t.slice(2),s?2:8):h.test(t)?l:+t}var f=function(){return i.r.Date.now()},m="Expected a function",v=Math.max,b=Math.min;function p(t,e,s){var r,n,o,a,l,h,c=0,d=!1,g=!1,p=!0;if("function"!=typeof t)throw new TypeError(m);function y(e){var s=r,i=n;return r=n=void 0,c=e,a=t.apply(i,s)}function S(t){var s=t-h;return void 0===h||s>=e||s<0||g&&t-c>=o}function T(){var t=f();if(S(t))return I(t);l=setTimeout(T,function(t){var s=e-(t-h);return g?b(s,o-(t-c)):s}(t))}function I(t){return l=void 0,p&&r?y(t):(r=n=void 0,a)}function R(){var t=f(),s=S(t);if(r=arguments,n=this,h=t,s){if(void 0===l)return function(t){return c=t,l=setTimeout(T,e),d?y(t):a}(h);if(g)return clearTimeout(l),l=setTimeout(T,e),y(h)}return void 0===l&&(l=setTimeout(T,e)),a}return e=u(e)||0,(0,i.a)(s)&&(d=!!s.leading,o=(g="maxWait"in s)?v(u(s.maxWait)||0,e):o,p="trailing"in s?!!s.trailing:p),R.cancel=function(){void 0!==l&&clearTimeout(l),c=0,r=h=n=l=void 0},R.flush=function(){return void 0===l?a:I(f())},R}},28115:(t,e,s)=>{s.r(e),s.d(e,{dyte_message_list_view:()=>o});var i=s(72944),r=(s(26468),s(60064),s(94370),s(17073)),n=(s(55055),s(91364));s(70694),s(64383),s(49583);const o=class{constructor(t){(0,i.r)(this,t),this.sizes=new Map,this.lastScrollTop=0,this.scrollToBottomRetries=0,this.elementObserver=(()=>{let t=null;const e=()=>t||("undefined"!=typeof ResizeObserver?t=new ResizeObserver((t=>{t.forEach((t=>{this.measureElement(t.target,t)}))})):null);return{disconnect:()=>{var t;return null===(t=e())||void 0===t?void 0:t.disconnect()},observe:t=>{var s;return null===(s=e())||void 0===s?void 0:s.observe(t,{box:"border-box"})},unobserve:t=>{var s;return null===(s=e())||void 0===s?void 0:s.unobserve(t)}}})(),this.measureElement=(t,e)=>{if(!t)return;const s=t.dataset.id;if(this.sizes.has(s))return void this.elementObserver.unobserve(t);if(e){const i=e.borderBoxSize[0];if(i&&i.blockSize>0)return this.saveItemSize(s,i.blockSize),void this.elementObserver.unobserve(t)}const i=t.getBoundingClientRect();i.height>0&&this.saveItemSize(s,i.height)},this.getVisibleItems=()=>this.messages.slice(this.range.start,this.range.end+1),this.updateVisibleItems=(t,e)=>{const s=this.messages.length;let i=t,r=e;s<=this.visibleItemsCount?(i=0,r=s-1):e-t<this.visibleItemsCount-1&&(i=this.range.end-this.visibleItemsCount+1),this.range.start!==i&&(this.range={start:i,end:r},this.totalHeight=this.getRangeSize(0,s))},this.getEstimatedItemSize=()=>this.estimateItemSize,this.getRangeSize=(t,e)=>{let s=0,i=0;for(let r=t;r<e;r++)i=this.sizes.get(this.messages[r].id),s+=i||this.getEstimatedItemSize();return s},this.getScrollTop=()=>this.$listRef?Math.ceil(this.$listRef.scrollTop):0,this.getClientHeight=()=>this.$listRef?Math.ceil(this.$listRef.clientHeight):0,this.getScrollHeight=()=>this.$listRef?Math.ceil(this.$listRef.scrollHeight):0,this.getItemsScrolled=()=>{const t=this.lastScrollTop;if(t<=0)return 0;let e=0,s=0,i=0,r=this.messages.length;for(;e<=r;){if(s=e+r>>>1,i=this.getRangeSize(0,s),i===t)return s;i<t?e=s+1:i>t&&(r=s-1)}return e>0?--e:0},this.getEndByStart=t=>Math.min(t+this.visibleItemsCount,this.messages.length-1),this.scrollToOffset=t=>{this.$listRef&&(this.$listRef.scrollTop=t)},this.scrollToIndex=t=>{if(t>=this.messages.length-1)this.scrollToBottom();else{const e=t<1?0:this.getRangeSize(0,t);this.scrollToOffset(e)}},this.scrollToBottom=()=>{this.$listEndRef&&(0,i.w)((()=>{this.$listEndRef.scrollIntoView(),this.getScrollHeight()-(this.getScrollTop()+this.getClientHeight())>0&&this.scrollToBottomRetries<10?setTimeout((()=>{this.scrollToBottom()}),1e3/60):(this.scrollToBottomRetries=0,this.autoScroll=!0)}))},this.handleScroll=async()=>{if(this.isFetching)return;const t=this.getScrollTop(),e=t<this.lastScrollTop||0===t?"UP":"DOWN";if(this.lastScrollTop=t,this.loadMore&&0===t&&"UP"===e&&!1===this.isFetching){this.isFetching=!0;const t=await this.loadMore(this.messages[0]);t&&t.length&&(this.messages=[...t,...this.messages]),this.isFetching=!1}"UP"===e?this.handleTop():"DOWN"===e&&this.handleBottom()},this.handleTop=()=>{const t=this.getItemsScrolled();if(t<=this.range.end-5&&(this.autoScroll=!1),t>this.range.start+5)return;const e=Math.max(this.range.start-5,0);this.updateVisibleItems(e,this.getEndByStart(e))},this.handleBottom=()=>{if(this.getItemsScrolled()<this.range.start+5)return;const t=this.range.start+5,e=this.getEndByStart(t);e===this.messages.length-1?this.updateVisibleItems(e-this.visibleItemsCount,e):this.updateVisibleItems(t,e)},this.updateTotalHeight=(0,n.d)((()=>{this.totalHeight=this.getRangeSize(0,this.messages.length)}),1e3/30,{leading:!0}),this.rendererInternal=(t,e,s)=>{if(!t)return;if(t.dataset.id===e.id)return;const i=this.renderer(e,s);t.hasChildNodes&&(t.innerHTML=""),this.elementObserver.observe(t),t.dataset.id=e.id,t.appendChild(i)},this.messages=void 0,this.renderer=void 0,this.loadMore=void 0,this.visibleItemsCount=20,this.estimateItemSize=100,this.iconPack=r.d,this.range=void 0,this.isFetching=!1,this.autoScroll=!0,this.totalHeight=0}connectedCallback(){const t=this.messages.length-1;this.range={start:t-this.visibleItemsCount,end:t},this.updateVisibleItems(this.range.start,this.range.end),this.totalHeight=this.getRangeSize(0,t)}componentDidLoad(){this.autoScroll&&this.scrollToBottom()}messagesUpdated(t,e){if(t.length>e.length){const s=t.length-e.length;this.updateVisibleItems(s,this.getEndByStart(s)),this.scrollToIndex(this.range.start)}}saveItemSize(t,e){this.sizes.set(t,Math.round(e)),this.updateTotalHeight()}render(){return(0,i.h)("div",{class:"scrollbar content-wrapper",ref:t=>this.$listRef=t,onScroll:this.handleScroll},(0,i.h)("div",{class:"scroller"},(0,i.h)("div",{style:{height:`${this.totalHeight}px`}}),(0,i.h)("div",{class:"smallest-dom-element",id:"list-end",ref:t=>this.$listEndRef=t})),(0,i.h)("div",{class:"content",style:{transform:`translateY(${this.getRangeSize(0,this.range.start)}px)`}},this.isFetching&&(0,i.h)("div",{class:"loader"},(0,i.h)("dyte-spinner",{size:"md"})),this.getVisibleItems().map(((t,e)=>(0,i.h)("div",{key:t.id,ref:s=>this.rendererInternal(s,t,e)})))))}static get watchers(){return{messages:["messagesUpdated"]}}};o.style=":host{line-height:initial;font-family:var(--dyte-font-family, sans-serif);font-feature-settings:normal;font-variation-settings:normal}p{margin:var(--dyte-space-0, 0px);padding:var(--dyte-space-0, 0px)}.scrollbar{scrollbar-width:thin;scrollbar-color:var(--dyte-scrollbar-color, rgb(var(--dyte-colors-background-600, 60 60 60)))\n    var(--dyte-scrollbar-background, transparent)}.scrollbar::-webkit-scrollbar{height:var(--dyte-space-1\\.5, 6px);width:var(--dyte-space-1\\.5, 6px);border-radius:9999px;background-color:var(--dyte-scrollbar-background, transparent)}.scrollbar::-webkit-scrollbar-thumb{border-radius:9999px;background-color:var(--dyte-scrollbar-color, rgb(var(--dyte-colors-background-600, 60 60 60)))}.loading{cursor:wait}.content-wrapper{height:100%;overflow-y:auto;position:relative;contain:strict}.scroller{width:1px;opacity:0}.content{position:absolute;top:0;width:100%}.smallest-dom-element{width:100%;height:2px;background:red}.loader{margin-top:var(--dyte-space-2, 8px);margin-bottom:var(--dyte-space-2, 8px);display:flex;justify-content:center}"},49583:(t,e,s)=>{s.d(e,{S:()=>o,a:()=>v,b:()=>m,f:()=>i,i:()=>b,r:()=>n});var i="object"==typeof s.g&&s.g&&s.g.Object===Object&&s.g,r="object"==typeof self&&self&&self.Object===Object&&self,n=i||r||Function("return this")(),o=n.Symbol,a=Object.prototype,l=a.hasOwnProperty,h=a.toString,c=o?o.toStringTag:void 0;var d=Object.prototype.toString;var g="[object Null]",u="[object Undefined]",f=o?o.toStringTag:void 0;function m(t){return null==t?void 0===t?u:g:f&&f in Object(t)?function(t){var e=l.call(t,c),s=t[c];try{t[c]=void 0;var i=!0}catch(n){}var r=h.call(t);return i&&(e?t[c]=s:delete t[c]),r}(t):function(t){return d.call(t)}(t)}function v(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function b(t){return null!=t&&"object"==typeof t}}}]);